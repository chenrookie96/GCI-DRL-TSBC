# DRL-TSBC算法复现任务列表

## 任务概述

本任务列表将DRL-TSBC算法的实现分解为可执行的代码任务。每个任务都基于需求文档和设计文档，按照依赖关系组织。

## 任务列表

- [x] 1. 项目基础设施搭建


  - 创建项目目录结构
  - 配置Python环境和依赖包
  - 创建配置文件(YAML)
  - _需求: 需求1, 需求10_





- [-] 2. 数据处理模块实现



  - 实现数据加载器(DataLoader)，支持加载乘客数据和交通数据
  - 实现配置管理器(ConfigManager)，读取YAML配置
  - 验证test_data数据格式和加载功能
  - _需求: 需求1_


- [ ] 3. 双向仿真环境核心实现
  - [ ] 3.1 实现单方向环境(DirectionEnvironment)
    - 实现车站状态管理
    - 实现乘客队列和上下车逻辑
    - 实现车辆位置追踪
    - 实现滞留乘客统计
    - _需求: 需求1_
  
  - [ ] 3.2 实现时间控制器(TimeController)
    - 实现分钟级时间推进
    - 实现首末班车判断
    - _需求: 需求1_
  
  - [ ] 3.3 实现双向环境主类(BidirectionalBusEnvironment)


    - 组合上行和下行环境
    - 实现reset()和step()方法
    - 实现环境状态更新逻辑
    - _需求: 需求1_

- [ ] 4. 状态空间计算实现
  - [x] 4.1 实现状态计算器(StateCalculator)


    - 实现时间状态计算(a1, a2)
    - 实现满载率计算(x1/y1)
    - 实现归一化等待时间计算(x2/y2)
    - 实现客运容量利用率计算(x3/y3)
    - 实现发车次数差异计算(x4/y4)
    - _需求: 需求2_
  
  - [-] 4.2 验证状态归一化

    - 确保所有状态值在[0,1]范围内
    - 验证10维状态向量结构
    - _需求: 需求2_

- [ ] 5. 奖励函数实现
  - 实现奖励计算器(RewardCalculator)
  - 实现双向奖励函数(公式2.16和2.17)
  - 实现发车次数平衡激励机制
  - 配置参数: μ=5000, δ=200, β=0.2, ζ=0.002
  - _需求: 需求4_

- [ ] 6. DQN网络架构实现
  - [ ] 6.1 实现DQN网络(DQNNetwork)
    - 构建12层隐藏层，每层500神经元
    - 使用ReLU激活函数
    - 实现正态分布权重初始化
    - _需求: 需求5_
  
  - [ ] 6.2 实现经验回放池(ReplayBuffer)
    - 使用deque实现容量3000的缓冲区
    - 实现push()和sample()方法
    - _需求: 需求6_
  
  - [ ] 6.3 实现DQN智能体(DQNAgent)
    - 创建主网络和目标网络
    - 实现ε-贪婪动作选择
    - 实现网络训练逻辑(MSE损失)
    - 实现目标网络更新(每100次)
    - 配置Adam优化器(lr=0.001)
    - _需求: 需求5, 需求6_

- [ ] 7. 发车约束处理实现
  - 实现约束检查器(DepartureConstraintChecker)
  - 实现最小/最大发车间隔约束(T_min, T_max)
  - 实现首末班车强制发车逻辑
  - _需求: 需求3_

- [ ] 8. 训练流程实现
  - [ ] 8.1 实现训练主循环(train_drl_tsbc)
    - 实现episode循环(最多50个)
    - 实现环境重置和状态更新
    - 集成约束检查
    - 实现经验存储和网络训练
    - _需求: 需求7_
  
  - [ ] 8.2 实现GPU加速支持
    - 实现GPU管理器(GPUManager)
    - 支持CUDA 11.8和RTX 3060
    - 实现CPU回退机制
    - _需求: 需求9_
  
  - [ ] 8.3 实现训练监控和日志
    - 实现日志系统(DRLTSBCLogger)
    - 记录每个episode的reward和loss
    - 实现模型定期保存
    - _需求: 需求7_

- [ ] 9. 推理和后处理实现
  - [ ] 9.1 实现推理流程(inference_drl_tsbc)
    - 使用训练好的模型生成时刻表
    - 实现贪婪动作选择(ε=0)
    - _需求: 需求8_
  
  - [ ] 9.2 实现后处理算法(post_process_timetable)
    - 实现发车次数平衡调整
    - 删除倒数第二次发车
    - 以T_max为间隔向前调整
    - 验证最终约束满足
    - _需求: 需求8_

- [ ] 10. 评估模块实现
  - [ ] 10.1 实现性能评估器(PerformanceEvaluator)
    - 计算乘客平均等待时间(AWT)
    - 统计发车次数
    - 统计滞留乘客数量
    - 计算客运容量利用率
    - _需求: 需求10_
  
  - [ ] 10.2 实现结果可视化(ResultVisualizer)
    - 绘制训练历史曲线
    - 绘制容量与需求对比图
    - 绘制性能对比柱状图
    - 绘制ω参数敏感性分析
    - _需求: 需求10_

- [ ] 11. 实验脚本实现
  - [ ] 11.1 创建训练脚本(train.py)
    - 加载配置和数据
    - 初始化环境和智能体
    - 执行训练流程
    - 保存模型和结果
    - _需求: 需求7_
  
  - [ ] 11.2 创建推理脚本(inference.py)
    - 加载训练好的模型
    - 生成时刻表
    - 保存时刻表到文件
    - _需求: 需求8_
  
  - [ ] 11.3 创建评估脚本(evaluate.py)
    - 加载模型和数据
    - 运行评估
    - 生成对比图表
    - 输出性能指标
    - _需求: 需求10_

- [ ] 12. 208线实验复现
  - 使用208线数据训练模型
  - 生成时刻表并评估
  - 对比人工方案性能
  - 验证乘客平均等待时间降低12.1%
  - 验证上下行发车次数相等
  - _需求: 需求10_

- [ ] 13. 211线实验复现
  - 使用211线数据训练模型
  - 生成时刻表并评估
  - 对比人工方案性能
  - 验证算法有效性
  - _需求: 需求10_

- [ ] 14. 文档和README
  - 编写README.md使用说明
  - 添加代码注释和文档字符串
  - 创建requirements.txt
  - 编写实验结果报告
  - _需求: 需求10_

## 任务执行说明

1. **按顺序执行**: 任务之间有依赖关系，建议按编号顺序执行
2. **子任务优先**: 有子任务的任务，先完成所有子任务
3. **测试验证**: 每完成一个任务，进行简单测试验证功能正确
4. **增量开发**: 每个任务只实现必要的功能，避免过度设计

## 关键里程碑

- **里程碑1**: 完成任务1-2，建立项目基础
- **里程碑2**: 完成任务3-5，实现仿真环境和状态/奖励计算
- **里程碑3**: 完成任务6-7，实现DQN网络和约束处理
- **里程碑4**: 完成任务8，实现训练流程并成功训练
- **里程碑5**: 完成任务9-11，实现推理和评估
- **里程碑6**: 完成任务12-13，复现论文实验结果

