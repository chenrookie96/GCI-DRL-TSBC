
\documentclass{article}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{xeCJK}
\setCJKmainfont{STSong}

\begin{document}

% 算法2.1: DRL-TSBC的学习过程
\begin{algorithm}
\caption{DRL-TSBC 的学习过程}
\label{alg:learning}
\begin{algorithmic}[1]
\REQUIRE 超参数: 经验池大小 $M$, 批次大小 $B$, 折扣因子 $\gamma$, 随机动作概率 $\epsilon$, 最大模拟次数 $E$, 学习频率 $P$, 模型更新频率 $O$, 首班车时间 $t_s$, 末班车时间 $t_e$
\ENSURE 训练好的DQN参数 $\theta$
\STATE 初始化经验池 $D$，主网络参数 $\theta$，和目标网络参数 $\theta^- = \theta$
\STATE 使用 $\theta$ 初始化主网络 $Q(s, a; \theta)$，并且使用 $\theta^-$ 初始化目标网络 $Q(s, a; \theta^-)$
\FOR{$episode = 1$ 到 $E$}
\STATE 初始化公交仿真环境
\FOR{所有 $i = t_s$ 转到 $t_e$ 进行}
\IF{在 $[0, 1]$ 区间内随机取出的一个实数小于 $\epsilon$ 则}
\STATE 随机选择动作 $a$
\ELSE
\STATE $a = \arg\max_a Q(s, a; \theta)$
\ENDIF
\STATE 通过 $a$ 计算 $I^{up}$ and $I^{down}$
\IF{$I^{up} < T_{min}$ 则}
\STATE $a_{up} \leftarrow 0$
\ENDIF
\IF{$I^{up} > T_{max}$ 则}
\STATE $a_{up} \leftarrow 1$
\ENDIF
\IF{$I^{down} < T_{min}$ 则}
\STATE $a_{down} \leftarrow 0$
\ENDIF
\IF{$I^{down} > T_{max}$ 则}
\STATE $a_{down} \leftarrow 1$
\ENDIF
\STATE $a \leftarrow (a_{up}, a_{down})$
\STATE 在环境中应用动作 $a$ 并得到奖励 $r$ 和下一个状态 $s'$
\STATE 将四元组 $(s, a, r, s')$ 添加到经验池 $D$ 中，同时如果 $|D| > M$，删除经验池中最旧的经验
\STATE $s = s'$, $i = i + 1$
\IF{$|D| > M$ 且 $i \bmod P = 0$ 则}
\STATE 从经验池 $D$ 中随机取出 $B$ 个四元组 $(s, a, r, s')$
\STATE 通过式(2.18)计算损失函数 $L$
\STATE 使用 Adam 反向传播通过 $L$ 更新 $\theta$
\STATE 每进行 $O$ 次学习，更新目标网络参数 $\theta^- = \theta$
\ENDIF
\ENDFOR
\ENDFOR
\end{algorithmic}
\end{algorithm}

% 算法2.2: DRL-TSBC的推理过程
\begin{algorithm}
\caption{DRL-TSBC 的推理过程}
\label{alg:inference}
\begin{algorithmic}[1]
\REQUIRE 训练好的DQN参数 $\theta$, 最大发车间隔 $T_{\max}$, 最小发车间隔 $T_{\min}$
\ENSURE 最终公交时刻表（发车时间点列表）
\STATE 初始化公交仿真环境
\FOR{所有 $i = t_s$ 转到 $t_e$ 进行}
\STATE $a = \arg\max_a Q(s, a; \theta)$
\STATE 通过 $a$ 计算 $I^{up}$ and $I^{down}$
\IF{$I^{up} < T_{min}$ 则}
\STATE $a_{up} \leftarrow 0$
\ENDIF
\IF{$I^{up} > T_{max}$ 则}
\STATE $a_{up} \leftarrow 1$
\ENDIF
\IF{$I^{down} < T_{min}$ 则}
\STATE $a_{down} \leftarrow 0$
\ENDIF
\IF{$I^{down} > T_{max}$ 则}
\STATE $a_{down} \leftarrow 1$
\ENDIF
\STATE $a \leftarrow (a_{up}, a_{down})$
\STATE 在环境中应用动作 $a$ 并得到下一个状态 $s'$
\STATE $s = s'$, $i = i + 1$
\ENDFOR
\STATE 选择发车次数更多的方向
\STATE 从时刻表中删除该方向的倒数第二次发车
\STATE $k \leftarrow$ 此时该方向的总发车次数
\WHILE{时刻表中的第 $k$ 次发车和第 $k - 1$ 次发车的间隔大于 $T_{max}$ 进行}
\STATE 将第 $k - 1$ 次发车的时间推迟直到其与下一次发车的间隔为 $T_{max}$
\STATE $k = k - 1$
\ENDWHILE
\end{algorithmic}
\end{algorithm}

\end{document}
